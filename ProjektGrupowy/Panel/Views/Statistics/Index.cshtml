@model Panel.Models.StatistiscViewModel
@{
    ViewBag.Title = "Statistics";
}

<body>
    <h2>Statistics</h2>

    <p id="aaa">Statistics of user @User.Identity.Name</p>

    <div class="row">
        @*@using (Html.BeginForm("Statistics", "Statistics", FormMethod.Post, new { @id = "myform", @class = "form-horizontal", role = "form" }))*@
        @using (Ajax.BeginForm("Statistics", "Statistics", new AjaxOptions(){
            OnSuccess = "showStatistics"
        }, new { @id = "myform", @class = "form-horizontal", role = "form" }))
        {
            <div class="form-group">
                <label for="type-input">Chart type:</label>
                @Html.DropDownListFor(model => model.CurrentChartType, Model.ChartTypes, new { @id = "type-input", @class = "form-control" })
            </div>
            <div class="form-group">
                <label for="start-input">Start date:</label>
                @Html.EditorFor(model => model.StartDate, new { htmlAttributes = new { @class = "form-control" } })
            </div>
            <div class="form-group">
                <label for="end-input">End date:</label>
                @Html.EditorFor(model => model.EndDate, new { htmlAttributes = new { @class = "form-control" } })
            </div>
            <div class="form-group">
                <label for="operator-input">Filter by attribute:</label>
                @Html.DropDownListFor(model => model.CurrentAttribute, Model.Attributes, new { @class = "form-control" })
            </div>
            //<button type="submit" class="btn btn-default">Submit</button>
            <input type="submit" value="Submit">
//            <input type="submit" value="Submit" style="visibility:hidden">

            //<button onclick="showStatistics()" class="btn btn-default">Show Statistics</button>
        }
</div>
    <div class="row" style="width:500px; height:500px;">
        <canvas id="myChart"></canvas>
    </div>
    <div class="row">
        <table class="table">
            <thead class="thead-inverse">
                <tr>
                    <th>Mac osx</th>
                    <th>Linux</th>
                    <th>Windows</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>12</td>
                    <td>19</td>
                    <td>13</td>
                </tr>
            </tbody>
        </table>
    </div>
</body>

@section scripts{
    <script type="text/javascript" language="javascript">
        var myChart = null;

        function showStatistics(json) {
            if (myChart != null) {
                myChart.destroy();
            }
            var chartType = $("#type-input option:selected").text();
            var ctx = document.getElementById('myChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: "pie",
                data: {
                    labels: json.labels,
                    datasets: [{
                        backgroundColor: [
                            "#2ecc71",
                            "#3498db",
                            "#95a5a6",
                            "#ff66ff",
                            "#660000"
                        ],
                        data: json.countedData
                    }]
                }

            });
                /*
                if (myChart != null) {
                    myChart.destroy();
                }
                var chartType = $("#type-input option:selected").text();
                var ctx = document.getElementById('myChart').getContext('2d');
                myChart = new Chart(ctx, {
                    type: chartType,
                    data: {
                        labels: ["linux", "mac osx", "windows"],
                        datasets: [{
                            backgroundColor: [
                              "#2ecc71",
                              "#3498db",
                              "#95a5a6"
                            ],
                            data: [12, 19, 3]
                        }]
                    }

                });
                */
            }
     </script>
}